
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://simonsobs.github.io/LAT_Alignment/5.2.0/reference/mirror/">
      
      
        <link rel="prev" href="../ixb/">
      
      
        <link rel="next" href="../photogrammetry/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>mirror - LAT_Alignment</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lat_alignment.mirror" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LAT_Alignment" class="md-header__button md-logo" aria-label="LAT_Alignment" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LAT_Alignment
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              mirror
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LAT_Alignment" class="md-nav__button md-logo" aria-label="LAT_Alignment" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    LAT_Alignment
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coordinate_systems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coordinate Systems
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../panel_numbers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Panel Numbering Scheme
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config_file/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration File
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../alignment_procedure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Alignment Procedure
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adjustments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    adjustments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alignment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    alignment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bearing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bearing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fitting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fitting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    io
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ixb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ixb
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    mirror
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    mirror
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror" class="md-nav__link">
    <span class="md-ellipsis">
      mirror
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel" class="md-nav__link">
    <span class="md-ellipsis">
      Panel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Panel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.adj_msk" class="md-nav__link">
    <span class="md-ellipsis">
      adj_msk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.can_surface" class="md-nav__link">
    <span class="md-ellipsis">
      can_surface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.meas_adj" class="md-nav__link">
    <span class="md-ellipsis">
      meas_adj
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.meas_adj_resid" class="md-nav__link">
    <span class="md-ellipsis">
      meas_adj_resid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.meas_surface" class="md-nav__link">
    <span class="md-ellipsis">
      meas_surface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.model" class="md-nav__link">
    <span class="md-ellipsis">
      model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.model_transformed" class="md-nav__link">
    <span class="md-ellipsis">
      model_transformed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.res_norm" class="md-nav__link">
    <span class="md-ellipsis">
      res_norm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.residuals" class="md-nav__link">
    <span class="md-ellipsis">
      residuals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.rms" class="md-nav__link">
    <span class="md-ellipsis">
      rms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.rot" class="md-nav__link">
    <span class="md-ellipsis">
      rot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.shift" class="md-nav__link">
    <span class="md-ellipsis">
      shift
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.transformed_residuals" class="md-nav__link">
    <span class="md-ellipsis">
      transformed_residuals
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror.gen_panels" class="md-nav__link">
    <span class="md-ellipsis">
      gen_panels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror.mirror_norm" class="md-nav__link">
    <span class="md-ellipsis">
      mirror_norm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror.mirror_surface" class="md-nav__link">
    <span class="md-ellipsis">
      mirror_surface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror.plot_panels" class="md-nav__link">
    <span class="md-ellipsis">
      plot_panels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror.remove_cm" class="md-nav__link">
    <span class="md-ellipsis">
      remove_cm
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../photogrammetry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    photogrammetry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transforms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    transforms
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror" class="md-nav__link">
    <span class="md-ellipsis">
      mirror
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel" class="md-nav__link">
    <span class="md-ellipsis">
      Panel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Panel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.adj_msk" class="md-nav__link">
    <span class="md-ellipsis">
      adj_msk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.can_surface" class="md-nav__link">
    <span class="md-ellipsis">
      can_surface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.meas_adj" class="md-nav__link">
    <span class="md-ellipsis">
      meas_adj
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.meas_adj_resid" class="md-nav__link">
    <span class="md-ellipsis">
      meas_adj_resid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.meas_surface" class="md-nav__link">
    <span class="md-ellipsis">
      meas_surface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.model" class="md-nav__link">
    <span class="md-ellipsis">
      model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.model_transformed" class="md-nav__link">
    <span class="md-ellipsis">
      model_transformed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.res_norm" class="md-nav__link">
    <span class="md-ellipsis">
      res_norm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.residuals" class="md-nav__link">
    <span class="md-ellipsis">
      residuals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.rms" class="md-nav__link">
    <span class="md-ellipsis">
      rms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.rot" class="md-nav__link">
    <span class="md-ellipsis">
      rot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.shift" class="md-nav__link">
    <span class="md-ellipsis">
      shift
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lat_alignment.mirror.Panel.transformed_residuals" class="md-nav__link">
    <span class="md-ellipsis">
      transformed_residuals
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror.gen_panels" class="md-nav__link">
    <span class="md-ellipsis">
      gen_panels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror.mirror_norm" class="md-nav__link">
    <span class="md-ellipsis">
      mirror_norm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror.mirror_surface" class="md-nav__link">
    <span class="md-ellipsis">
      mirror_surface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror.plot_panels" class="md-nav__link">
    <span class="md-ellipsis">
      plot_panels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lat_alignment.mirror.remove_cm" class="md-nav__link">
    <span class="md-ellipsis">
      remove_cm
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>mirror</h1>

<div class="doc doc-object doc-module">



<a id="lat_alignment.mirror"></a>
    <div class="doc doc-contents first">

        <p>Functions to describe the mirror surface.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="lat_alignment.mirror.Panel" class="doc doc-heading">
            <code>Panel</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Dataclass for storing a mirror panel.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="lat_alignment.mirror.Panel.mirror">mirror</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which mirror this panel is for.
Should be 'primary' or 'secondary'.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="lat_alignment.mirror.Panel.row">row</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The row of the panel.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="lat_alignment.mirror.Panel.col">col</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The column of the panel.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="lat_alignment.mirror.Panel.corners">corners</span></code></td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of panel corners.
Should have shape <code>(4, 3)</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="lat_alignment.mirror.Panel.measurements">measurements</span></code></td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The measurement data for this panel.
Should be in the mirror's internal coords.
Should have shape <code>(npoint, 3)</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="lat_alignment.mirror.Panel.nom_adj">nom_adj</span></code></td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The nominal position of the adjusters in the mirror internal coordinates.
Should have shape <code>(5, 3)</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="lat_alignment.mirror.Panel.compensate">compensate</span></code></td>
            <td>
                  <code>float, default: 0</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The amount (in mm) to compensate the model surface by.
This is to account for things like the Faro SMR.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>lat_alignment/mirror.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Panel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dataclass for storing a mirror panel.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    mirror : str</span>
<span class="sd">        Which mirror this panel is for.</span>
<span class="sd">        Should be &#39;primary&#39; or &#39;secondary&#39;.</span>
<span class="sd">    row : int</span>
<span class="sd">        The row of the panel.</span>
<span class="sd">    col : int</span>
<span class="sd">        The column of the panel.</span>
<span class="sd">    corners : NDArray[np.float32]</span>
<span class="sd">        Array of panel corners.</span>
<span class="sd">        Should have shape `(4, 3)`.</span>
<span class="sd">    measurements : NDArray[np.float32]</span>
<span class="sd">        The measurement data for this panel.</span>
<span class="sd">        Should be in the mirror&#39;s internal coords.</span>
<span class="sd">        Should have shape `(npoint, 3)`.</span>
<span class="sd">    nom_adj : NDArray[np.float32]</span>
<span class="sd">        The nominal position of the adjusters in the mirror internal coordinates.</span>
<span class="sd">        Should have shape `(5, 3)`.</span>
<span class="sd">    compensate : float, default: 0</span>
<span class="sd">        The amount (in mm) to compensate the model surface by.</span>
<span class="sd">        This is to account for things like the Faro SMR.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mirror</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">row</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">col</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">corners</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]</span>
    <span class="n">measurements</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]</span>
    <span class="n">nom_adj</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]</span>
    <span class="n">compensate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">adjuster_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">50.0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;nom_adj&quot;</span>
            <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;mirror&quot;</span>
            <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;measurements&quot;</span>
            <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;compensate&quot;</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;can_surface&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;residuals&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;transformed_residuals&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;res_norm&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;rms&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;meas_surface&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;meas_adj&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;meas_adj_resid&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;model_transformed&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_transform&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;adjuster_radius&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;meas_adj_resid&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The modeled mirror surface at the locations of the measurementss.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">model</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mirror_surface</span><span class="p">(</span><span class="n">model</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">model</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compensate</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">compensation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compensate</span> <span class="o">*</span> <span class="n">mirror_norm</span><span class="p">(</span>
                <span class="n">model</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">model</span><span class="p">[:</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">model</span> <span class="o">+=</span> <span class="n">compensation</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_rigid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">,</span> <span class="n">center_dst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotation that aligns the model to the measurements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">shift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shift that aligns the model to the measurements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">can_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the cannonical points to define the panel surface.</span>
<span class="sd">        These are the adjuster positions projected only the mirror surface.</span>
<span class="sd">        Note that this is in the nominal coordinates not the measured ones.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">can_z</span> <span class="o">=</span> <span class="n">mirror_surface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nom_adj</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nom_adj</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">])</span>
        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nom_adj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">points</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">can_z</span>
        <span class="k">return</span> <span class="n">points</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">meas_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The cannonical surface transformed to be in the measured coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">apply_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">can_surface</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">meas_adj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The adjuster points transformed to be in the measured coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">apply_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nom_adj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">meas_adj_resid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A correction that can be applied to `meas_adj` where we compute</span>
<span class="sd">        the average residual of measured points from the transformed model</span>
<span class="sd">        that are within `adjuster_radius` of the adjuster point in `xy`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meas_adj</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">adj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meas_adj</span><span class="p">):</span>
            <span class="n">dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">adj</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">msk</span> <span class="o">=</span> <span class="n">dists</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjuster_radius</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">msk</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">resid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformed_residuals</span><span class="p">[</span><span class="n">msk</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">resid</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">adj_msk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a mask that only is True for measurements that are close to an adjustor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">msk</span>
        <span class="k">for</span> <span class="n">adj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meas_adj</span><span class="p">:</span>
            <span class="n">dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">adj</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">msk</span> <span class="o">+=</span> <span class="n">dists</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjuster_radius</span>
        <span class="k">return</span> <span class="n">msk</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">model_transformed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The model transformed to be in the measured coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">apply_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get residuals between model and measurements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">transformed_residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get residuals between transformed model and measurements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_transformed</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">res_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get norm of residuals between transformed model and measurements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get rms between model and measurements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="lat_alignment.mirror.Panel.adj_msk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">adj_msk</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a mask that only is True for measurements that are close to an adjustor.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="lat_alignment.mirror.Panel.can_surface" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_surface</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the cannonical points to define the panel surface.
These are the adjuster positions projected only the mirror surface.
Note that this is in the nominal coordinates not the measured ones.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="lat_alignment.mirror.Panel.meas_adj" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">meas_adj</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The adjuster points transformed to be in the measured coordinates.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="lat_alignment.mirror.Panel.meas_adj_resid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">meas_adj_resid</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>A correction that can be applied to <code>meas_adj</code> where we compute
the average residual of measured points from the transformed model
that are within <code>adjuster_radius</code> of the adjuster point in <code>xy</code>.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="lat_alignment.mirror.Panel.meas_surface" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">meas_surface</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The cannonical surface transformed to be in the measured coordinates.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="lat_alignment.mirror.Panel.model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The modeled mirror surface at the locations of the measurementss.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="lat_alignment.mirror.Panel.model_transformed" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">model_transformed</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The model transformed to be in the measured coordinates.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="lat_alignment.mirror.Panel.res_norm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">res_norm</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get norm of residuals between transformed model and measurements.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="lat_alignment.mirror.Panel.residuals" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">residuals</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get residuals between model and measurements.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="lat_alignment.mirror.Panel.rms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rms</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get rms between model and measurements.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="lat_alignment.mirror.Panel.rot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rot</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Rotation that aligns the model to the measurements.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="lat_alignment.mirror.Panel.shift" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shift</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Shift that aligns the model to the measurements.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="lat_alignment.mirror.Panel.transformed_residuals" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transformed_residuals</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get residuals between transformed model and measurements.</p>
    </div>

</div>





  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="lat_alignment.mirror.gen_panels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gen_panels</span><span class="p">(</span><span class="n">mirror</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">corners</span><span class="p">,</span> <span class="n">adjusters</span><span class="p">,</span> <span class="n">compensate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">adjuster_radius</span><span class="o">=</span><span class="mf">50.0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Use a set of measurements to generate panel objects.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mirror</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mirror these panels belong to.
Should be 'primary' or 'secondary'.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="lat_alignment.photogrammetry.Dataset" href="../photogrammetry/#lat_alignment.photogrammetry.Dataset">Dataset</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The photogrammetry data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>corners</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>], <span title="ndarray">ndarray</span>[<span title="numpy.float32">float32</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The corners. This is indexed by a (row, col) tuple.
Each entry is <code>(4, 3)</code> array where each row is a corner.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>adjusters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>], <span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Nominal adjuster locations.
This is indexed by a (row, col) tuple.
Each entry is <code>(5, 3)</code> array where each row is an adjuster.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compensate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Amount (in mm) to compensate the model surface by.
This is to account for things like the faro SMR.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>adjuster_radius</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The radius in XY of points that an adjuster should use to
compute a secondary correction on its position.
Should be in mm.</p>
              </div>
            </td>
            <td>
                  <code>50.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>panels</code></td>            <td>
                  <code><span title="list">list</span>[<span title="Panels">Panels</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of panels with the transforme initialized to the identity.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lat_alignment/mirror.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">gen_panels</span><span class="p">(</span>
    <span class="n">mirror</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
    <span class="n">corners</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]],</span>
    <span class="n">adjusters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]],</span>
    <span class="n">compensate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">adjuster_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Panel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use a set of measurements to generate panel objects.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mirror : str</span>
<span class="sd">        The mirror these panels belong to.</span>
<span class="sd">        Should be &#39;primary&#39; or &#39;secondary&#39;.</span>
<span class="sd">    dataset : Dataset</span>
<span class="sd">        The photogrammetry data.</span>
<span class="sd">    corners : dict[tuple[int, int], ndarray[np.float32]]</span>
<span class="sd">        The corners. This is indexed by a (row, col) tuple.</span>
<span class="sd">        Each entry is `(4, 3)` array where each row is a corner.</span>
<span class="sd">    adjusters : dict[tuple[int, int], NDArray[np.float32]]</span>
<span class="sd">        Nominal adjuster locations.</span>
<span class="sd">        This is indexed by a (row, col) tuple.</span>
<span class="sd">        Each entry is `(5, 3)` array where each row is an adjuster.</span>
<span class="sd">    compensate : float, default: 0.0</span>
<span class="sd">        Amount (in mm) to compensate the model surface by.</span>
<span class="sd">        This is to account for things like the faro SMR.</span>
<span class="sd">    adjuster_radius : float, default: 50.0</span>
<span class="sd">        The radius in XY of points that an adjuster should use to</span>
<span class="sd">        compute a secondary correction on its position.</span>
<span class="sd">        Should be in mm.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    panels : list[Panels]</span>
<span class="sd">        A list of panels with the transforme initialized to the identity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1"># dumb brute force</span>
    <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">rc</span><span class="p">,</span> <span class="n">crns</span> <span class="ow">in</span> <span class="n">corners</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">crns</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">crns</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">corr</span><span class="p">):</span>
                <span class="n">points</span><span class="p">[</span><span class="n">rc</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">point</span><span class="p">]</span>
                <span class="k">break</span>

    <span class="c1"># Now init the objects</span>
    <span class="n">panels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">),</span> <span class="n">meas</span> <span class="ow">in</span> <span class="n">points</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">meas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">meas</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">Panel</span><span class="p">(</span>
            <span class="n">mirror</span><span class="p">,</span>
            <span class="n">row</span><span class="p">,</span>
            <span class="n">col</span><span class="p">,</span>
            <span class="n">corners</span><span class="p">[(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)],</span>
            <span class="n">meas</span><span class="p">,</span>
            <span class="n">adjusters</span><span class="p">[(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)],</span>
            <span class="n">compensate</span><span class="p">,</span>
            <span class="n">adjuster_radius</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">panels</span> <span class="o">+=</span> <span class="p">[</span><span class="n">panel</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">panels</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lat_alignment.mirror.mirror_norm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mirror_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Analytic form of the vector normal to the mirror surface.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>X positions to calculate at in mm.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Y positions to calculate at in mm.
Should have the same shape as <code>x</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>a</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coeffecients of the mirror function.
Use <code>a_primary</code> for the primary mirror.
Use <code>a_secondary</code> for the secondary mirror.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>normals</code></td>            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unit vector normal to the mirror surface at each input coordinate.
Has shape <code>shape(x) + (3,)</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lat_alignment/mirror.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mirror_norm</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">a</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analytic form of the vector normal to the mirror surface.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : NDArray[np.float32]</span>
<span class="sd">        X positions to calculate at in mm.</span>
<span class="sd">    y : NDArray[np.float32]</span>
<span class="sd">        Y positions to calculate at in mm.</span>
<span class="sd">        Should have the same shape as `x`.</span>
<span class="sd">    a : NDArray[np.float32]</span>
<span class="sd">        Coeffecients of the mirror function.</span>
<span class="sd">        Use `a_primary` for the primary mirror.</span>
<span class="sd">        Use `a_secondary` for the secondary mirror.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    normals : NDArray[np.float32]</span>
<span class="sd">        Unit vector normal to the mirror surface at each input coordinate.</span>
<span class="sd">        Has shape `shape(x) + (3,)`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Rn</span> <span class="o">=</span> <span class="mf">3000.0</span>

    <span class="n">x_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x_n</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">Rn</span><span class="o">**</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">Rn</span><span class="p">)</span> <span class="o">**</span> <span class="n">j</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y_n</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">Rn</span><span class="p">)</span> <span class="o">**</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">Rn</span><span class="o">**</span><span class="n">j</span><span class="p">)</span>

    <span class="n">z_n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_n</span><span class="p">)</span>
    <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">,</span> <span class="n">z_n</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">normals</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">normals</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lat_alignment.mirror.mirror_surface" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mirror_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Analytic form of the mirror surface.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>X positions to calculate at in mm.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Y positions to calculate at in mm.
Should have the same shape as <code>x</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>a</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coeffecients of the mirror function.
Use <code>a_primary</code> for the primary mirror.
Use <code>a_secondary</code> for the secondary mirror.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>z</code></td>            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Z position of the mirror at each input coordinate.
Has the same shape as <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lat_alignment/mirror.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mirror_surface</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">a</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analytic form of the mirror surface.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : NDArray[np.float32]</span>
<span class="sd">        X positions to calculate at in mm.</span>
<span class="sd">    y : NDArray[np.float32]</span>
<span class="sd">        Y positions to calculate at in mm.</span>
<span class="sd">        Should have the same shape as `x`.</span>
<span class="sd">    a : NDArray[np.float32]</span>
<span class="sd">        Coeffecients of the mirror function.</span>
<span class="sd">        Use `a_primary` for the primary mirror.</span>
<span class="sd">        Use `a_secondary` for the secondary mirror.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    z : NDArray[np.float32]</span>
<span class="sd">        Z position of the mirror at each input coordinate.</span>
<span class="sd">        Has the same shape as `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">Rn</span> <span class="o">=</span> <span class="mf">3000.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">z</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">Rn</span><span class="p">)</span> <span class="o">**</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">Rn</span><span class="p">)</span> <span class="o">**</span> <span class="n">j</span>
    <span class="k">return</span> <span class="n">z</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lat_alignment.mirror.plot_panels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_panels</span><span class="p">(</span><span class="n">panels</span><span class="p">,</span> <span class="n">title_str</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Make a plot containing panel residuals and histogram.
TODO: Correlation?</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>panels</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="lat_alignment.mirror.Panel" href="#lat_alignment.mirror.Panel">Panel</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The panels to plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>title_str</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The title string, rms will me appended.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vmax</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The max of the colorbar. vmin will be -1 times this.
Set to None to compute automatically.
Should be in um.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>figure</code></td>            <td>
                  <code><span title="matplotlib.figure.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The figure with panels plotted on it.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lat_alignment/mirror.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_panels</span><span class="p">(</span>
    <span class="n">panels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Panel</span><span class="p">],</span> <span class="n">title_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">vmax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a plot containing panel residuals and histogram.</span>
<span class="sd">    TODO: Correlation?</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    panels : list[Panel]</span>
<span class="sd">        The panels to plot.</span>
<span class="sd">    title_str : str</span>
<span class="sd">        The title string, rms will me appended.</span>
<span class="sd">    vmax : Optional[float], default: None</span>
<span class="sd">        The max of the colorbar. vmin will be -1 times this.</span>
<span class="sd">        Set to None to compute automatically.</span>
<span class="sd">        Should be in um.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    figure : Figure</span>
<span class="sd">        The figure with panels plotted on it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">panel</span><span class="o">.</span><span class="n">residuals</span> <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="n">model_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">panel</span><span class="o">.</span><span class="n">model</span> <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">res_all</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;vmax still None?&quot;</span><span class="p">)</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">model</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Can&#39;t plot panel (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">), not enough points&quot;</span><span class="p">,</span> <span class="n">panel</span><span class="o">.</span><span class="n">row</span><span class="p">,</span> <span class="n">panel</span><span class="o">.</span><span class="n">col</span>
            <span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">model</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">model</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">residuals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">vmax</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">model</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">model</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="n">panel</span><span class="o">.</span><span class="n">residuals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">vmax</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">meas_adj</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">meas_adj</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span>
        <span class="n">model_all</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">model_all</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">res_all</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">vmax</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x (mm)&quot;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y (mm)&quot;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">3300</span><span class="p">,</span> <span class="mi">3300</span><span class="p">)</span>  <span class="c1"># ack hardcoded!</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">3300</span><span class="p">,</span> <span class="mi">3300</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span> <span class="n">cax</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">:</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
            <span class="n">Polygon</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">corners</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">res_all</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">panels</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;z residual (um)&quot;</span><span class="p">)</span>

    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">measurements</span><span class="p">)</span> <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">])</span>
    <span class="n">rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">panel</span><span class="o">.</span><span class="n">rms</span> <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">])</span>
    <span class="n">tot_rms</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rms</span> <span class="o">*</span> <span class="n">points</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title_str</span><span class="si">}</span><span class="s2">, RMS=</span><span class="si">{</span><span class="n">tot_rms</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> um&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lat_alignment.mirror.remove_cm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_cm</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">mirror</span><span class="p">,</span> <span class="n">compensate</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cut_thresh</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">niters</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Fit for the common mode transformation from the model to the measurements of all panels and them remove it.
Note that this will remove all coded targets from the dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="lat_alignment.photogrammetry.Dataset" href="../photogrammetry/#lat_alignment.photogrammetry.Dataset">Dataset</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The photogrammetry data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mirror</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mirror this data belong to.
Should be 'primary' or 'secondary'.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compensate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Compensation to apply to model.
This is to account for the radius of a Faro SMR.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>thresh</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many times higher than the median residual a point needs to have to be
considered an outlier.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>niters</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many iterations of common mode fitting to do.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>kept_points</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="lat_alignment.photogrammetry.Dataset" href="../photogrammetry/#lat_alignment.photogrammetry.Dataset">Dataset</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The points that were successfully fit with the common mode removed.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>common_mode</code></td>            <td>
                  <code><span title="tuple">tuple</span>[<span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>], <span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The common mode that was removed.
The first element is an affine matrix and
the second is the shift.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>lat_alignment/mirror.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_cm</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
    <span class="n">mirror</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">compensate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">thresh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">cut_thresh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">niters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Dataset</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit for the common mode transformation from the model to the measurements of all panels and them remove it.</span>
<span class="sd">    Note that this will remove all coded targets from the dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataset : Dataset</span>
<span class="sd">        The photogrammetry data.</span>
<span class="sd">    mirror : str</span>
<span class="sd">        The mirror this data belong to.</span>
<span class="sd">        Should be &#39;primary&#39; or &#39;secondary&#39;.</span>
<span class="sd">    compensate : float, default: 0</span>
<span class="sd">        Compensation to apply to model.</span>
<span class="sd">        This is to account for the radius of a Faro SMR.</span>
<span class="sd">    thresh : float, default: 10</span>
<span class="sd">        How many times higher than the median residual a point needs to have to be</span>
<span class="sd">        considered an outlier.</span>
<span class="sd">    niters : int, default: 10</span>
<span class="sd">        How many iterations of common mode fitting to do.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    kept_points: Dataset</span>
<span class="sd">        The points that were successfully fit with the common mode removed.</span>
<span class="sd">    common_mode : tuple[NDArray[np.float32], NDArray[np.float32]]</span>
<span class="sd">        The common mode that was removed.</span>
<span class="sd">        The first element is an affine matrix and</span>
<span class="sd">        the second is the shift.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing common mode for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mirror</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">panel</span><span class="p">):</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span><span class="p">[:]</span> <span class="o">-=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_euler</span><span class="p">(</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span> <span class="o">=</span> <span class="n">rot</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">measurements</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span> <span class="o">*=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_opt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">panel</span><span class="p">):</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="n">_cm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p2</span><span class="o">.</span><span class="n">rms</span>

    <span class="c1"># make a fake panel for the full mirror</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">([</span><span class="o">-</span><span class="mi">3300</span><span class="p">,</span> <span class="o">-</span><span class="mi">3300</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">3300</span><span class="p">,</span> <span class="mi">3300</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">3300</span><span class="p">,</span> <span class="mi">3300</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">3300</span><span class="p">,</span> <span class="o">-</span><span class="mi">3300</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="p">)</span>  <span class="c1"># ack hardcoded</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">target_labels</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">targets</span>
    <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">corners</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">corners</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">msk</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="n">corr</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">msk</span> <span class="o">*=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">500</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span>
    <span class="n">panel</span> <span class="o">=</span> <span class="n">Panel</span><span class="p">(</span>
        <span class="n">mirror</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;float32&quot;</span><span class="p">),</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;float32&quot;</span><span class="p">),</span>
        <span class="n">compensate</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data_clean</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Removed </span><span class="si">%d</span><span class="s2"> points not on mirror surface&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">msk</span><span class="p">))</span>

    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">3</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niters</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">measurements</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">iter </span><span class="si">%d</span><span class="s2"> for common mode fit&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">cut</span> <span class="o">=</span> <span class="n">panel</span><span class="o">.</span><span class="n">res_norm</span> <span class="o">&gt;</span> <span class="n">thresh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">res_norm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cut</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span> <span class="o">=</span> <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span><span class="p">[</span><span class="o">~</span><span class="n">cut</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">cut</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Removing a naive common mode shift of </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">shift</span><span class="p">))</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span> <span class="o">-=</span> <span class="n">panel</span><span class="o">.</span><span class="n">shift</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span> <span class="o">@=</span> <span class="n">panel</span><span class="o">.</span><span class="n">rot</span><span class="o">.</span><span class="n">T</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">_opt</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="p">(</span><span class="n">panel</span><span class="p">,),</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Removing a fit common mode with scale </span><span class="si">%f</span><span class="s2">, shift </span><span class="si">%s</span><span class="s2">, and rotation </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">:]),</span>
        <span class="p">)</span>
        <span class="n">_cm</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">panel</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Removing a secondary common mode shift of </span><span class="si">%s</span><span class="s2"> and rotation of </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">shift</span><span class="p">),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">decompose_rotation</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">rot</span><span class="p">))),</span>
        <span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span> <span class="o">-=</span> <span class="n">panel</span><span class="o">.</span><span class="n">shift</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span> <span class="o">@=</span> <span class="n">panel</span><span class="o">.</span><span class="n">rot</span><span class="o">.</span><span class="n">T</span>

    <span class="n">aff</span><span class="p">,</span> <span class="n">sft</span> <span class="o">=</span> <span class="n">get_affine</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">scale</span><span class="p">,</span> <span class="n">shear</span><span class="p">,</span> <span class="n">rot</span> <span class="o">=</span> <span class="n">decompose_affine</span><span class="p">(</span><span class="n">aff</span><span class="p">)</span>
    <span class="n">rot</span> <span class="o">=</span> <span class="n">decompose_rotation</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Full common mode is:</span><span class="se">\n\t\t\t</span><span class="s2">shift = </span><span class="si">%s</span><span class="s2"> mm</span><span class="se">\n\t\t\t</span><span class="s2">scale = </span><span class="si">%s</span><span class="se">\n\t\t\t</span><span class="s2">shear = </span><span class="si">%s</span><span class="se">\n\t\t\t</span><span class="s2">rot = </span><span class="si">%s</span><span class="s2"> deg&quot;</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">sft</span><span class="p">),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">scale</span><span class="p">),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">shear</span><span class="p">),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">rot</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span> <span class="o">=</span> <span class="n">apply_transform</span><span class="p">(</span><span class="n">data_clean</span><span class="p">,</span> <span class="n">aff</span><span class="p">,</span> <span class="n">sft</span><span class="p">)</span>
    <span class="n">cut</span> <span class="o">=</span> <span class="n">panel</span><span class="o">.</span><span class="n">res_norm</span> <span class="o">&gt;</span> <span class="n">cut_thresh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">res_norm</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cut</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Removing </span><span class="si">%d</span><span class="s2"> bad points from mirror&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cut</span><span class="p">))</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span> <span class="o">=</span> <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span><span class="p">[</span><span class="o">~</span><span class="n">cut</span><span class="p">]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="o">~</span><span class="n">cut</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Mirror has </span><span class="si">%d</span><span class="s2"> good points&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">measurements</span><span class="p">))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">l</span><span class="p">:</span> <span class="n">d</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">panel</span><span class="o">.</span><span class="n">measurements</span><span class="p">)}</span>

    <span class="k">return</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="p">(</span><span class="n">aff</span><span class="p">,</span> <span class="n">sft</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>